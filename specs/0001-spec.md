# Intelli-TARA 智能威胁分析与风险评估平台

## 需求与设计规格说明书

**版本**: 1.0
**日期**: 2026-01-16
**状态**: 草稿

---

## 目录

1. [项目概述](#1-项目概述)
2. [功能需求](#2-功能需求)
3. [非功能需求](#3-非功能需求)
4. [系统架构](#4-系统架构)
5. [模块设计](#5-模块设计)
6. [数据模型](#6-数据模型)
7. [API设计](#7-api设计)
8. [集成设计](#8-集成设计)
9. [安全设计](#9-安全设计)
10. [部署方案](#10-部署方案)

---

## 1. 项目概述

### 1.1 项目背景

随着汽车智能化、网联化程度的不断提升，汽车网络安全问题日益突出。ISO/SAE 21434标准《道路车辆-网络安全工程》为汽车行业提供了网络安全工程的框架和方法论，其中威胁分析与风险评估（TARA）是核心活动之一。

传统TARA工作主要依赖人工完成，存在以下问题：
- 工作量大、耗时长
- 依赖专家经验，结果一致性差
- 资产识别和威胁分析容易遗漏
- 报告生成效率低

### 1.2 项目目标

构建面向汽车行业的智能威胁分析与风险评估（TARA）平台，基于ISO/SAE 21434标准，结合AI智能体技术，实现：

1. **自动化文档解析**: 支持多种格式文档的智能解析
2. **智能资产识别**: 从文档中自动识别和分类资产
3. **知识图谱构建**: 构建资产关系图谱，支持关联分析
4. **智能威胁分析**: 基于STRIDE模型和WP29威胁库自动识别威胁
5. **风险自动评估**: 自动计算攻击可行性和影响等级
6. **报告自动生成**: 生成符合标准格式的TARA报告

### 1.3 适用范围

- 汽车OEM整车厂
- 汽车Tier1/Tier2供应商
- 汽车网络安全咨询机构
- 汽车网络安全检测机构

### 1.4 参考标准

| 标准编号 | 标准名称 |
|---------|---------|
| ISO/SAE 21434:2021 | 道路车辆-网络安全工程 |
| UN R155 | 网络安全和网络安全管理系统 |
| UN R156 | 软件更新和软件更新管理系统 |
| ISO 31000 | 风险管理指南 |

---

## 2. 功能需求

### 2.1 项目管理模块

#### 2.1.1 项目创建与配置

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| PM-001 | 创建项目 | 创建新的TARA分析项目，填写项目基本信息 | P0 |
| PM-002 | 项目配置 | 配置项目参数，包括分析范围、评估标准等 | P0 |
| PM-003 | 项目列表 | 查看所有项目列表，支持搜索、筛选、排序 | P0 |
| PM-004 | 项目详情 | 查看项目详细信息和分析进度 | P0 |
| PM-005 | 项目归档 | 归档已完成的项目 | P1 |
| PM-006 | 项目导出 | 导出项目数据和报告 | P0 |
| PM-007 | 项目复制 | 基于已有项目创建新项目 | P2 |

#### 2.1.2 版本管理

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| PM-101 | 创建版本 | 为项目创建新的分析版本 | P0 |
| PM-102 | 版本列表 | 查看项目所有版本 | P0 |
| PM-103 | 版本对比 | 对比不同版本的分析结果差异 | P1 |
| PM-104 | 版本回退 | 回退到历史版本 | P2 |

#### 2.1.3 团队协作

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| PM-201 | 成员管理 | 添加/移除项目成员 | P1 |
| PM-202 | 角色权限 | 设置成员角色和权限 | P1 |
| PM-203 | 操作日志 | 记录项目操作日志 | P1 |

### 2.2 文档解析模块

#### 2.2.1 文档上传

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| DP-001 | 文档上传 | 上传单个或批量文档 | P0 |
| DP-002 | 文档类型 | 支持doc/docx/pdf/xlsx/xls/ppt/pptx/png/jpg/jpeg格式 | P0 |
| DP-003 | 文档预览 | 在线预览已上传文档 | P1 |
| DP-004 | 文档管理 | 文档列表、删除、重新上传 | P0 |
| DP-005 | 文档分类 | 将文档分类（架构图/功能清单/通信矩阵等） | P0 |

#### 2.2.2 智能解析

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| DP-101 | OCR识别 | 图片文档OCR文字识别 | P0 |
| DP-102 | 架构图解析 | 识别架构图中的组件、接口、数据流 | P0 |
| DP-103 | 表格解析 | 解析Excel/Word中的表格数据 | P0 |
| DP-104 | 文本提取 | 从PDF/Word文档中提取结构化文本 | P0 |
| DP-105 | 通信矩阵解析 | 解析通信矩阵，识别通信关系 | P0 |
| DP-106 | 解析结果校验 | 人工校验和修正解析结果 | P0 |

### 2.3 资产识别模块

#### 2.3.1 自动识别

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| AI-001 | 资产提取 | 从解析结果中自动识别资产 | P0 |
| AI-002 | 资产分类 | 自动对资产进行分类（硬件/软件/数据/接口等） | P0 |
| AI-003 | 属性标注 | 自动标注资产安全属性（CIA+真实性+不可抵赖性+权限） | P0 |
| AI-004 | 关系识别 | 识别资产之间的关联关系 | P0 |
| AI-005 | 重复检测 | 检测并合并重复资产 | P1 |

#### 2.3.2 资产管理

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| AI-101 | 资产列表 | 查看项目所有资产 | P0 |
| AI-102 | 资产编辑 | 手动编辑资产信息 | P0 |
| AI-103 | 资产新增 | 手动添加资产 | P0 |
| AI-104 | 资产删除 | 删除资产 | P0 |
| AI-105 | 批量操作 | 批量编辑/删除资产 | P1 |
| AI-106 | 资产导入 | 从Excel导入资产 | P1 |
| AI-107 | 资产导出 | 导出资产列表 | P1 |

### 2.4 威胁风险分析模块

#### 2.4.1 威胁识别

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| TA-001 | 威胁生成 | 基于STRIDE模型自动生成威胁场景 | P0 |
| TA-002 | 攻击路径 | 自动生成攻击路径描述 | P0 |
| TA-003 | WP29映射 | 自动映射WP29威胁类型 | P0 |
| TA-004 | 威胁编辑 | 手动编辑威胁信息 | P0 |
| TA-005 | 威胁新增 | 手动添加威胁 | P0 |
| TA-006 | 威胁删除 | 删除威胁 | P0 |

#### 2.4.2 攻击可行性分析

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| TA-101 | 攻击向量评估 | 评估攻击向量（物理/本地/邻近/网络） | P0 |
| TA-102 | 攻击复杂度评估 | 评估攻击复杂度（高/低） | P0 |
| TA-103 | 权限需求评估 | 评估所需权限（无/低/高） | P0 |
| TA-104 | 用户交互评估 | 评估用户交互需求（需要/不需要） | P0 |
| TA-105 | 可行性计算 | 自动计算攻击可行性等级 | P0 |

#### 2.4.3 影响分析

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| TA-201 | 安全影响评估 | 评估对Safety的影响（S0-S3） | P0 |
| TA-202 | 财务影响评估 | 评估财务影响（F0-F3） | P0 |
| TA-203 | 运营影响评估 | 评估运营影响（O0-O3） | P0 |
| TA-204 | 隐私影响评估 | 评估隐私和法规影响（P0-P3） | P0 |
| TA-205 | 影响等级计算 | 自动计算综合影响等级 | P0 |

#### 2.4.4 风险评估

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| TA-301 | 风险等级计算 | 根据可行性和影响计算风险等级 | P0 |
| TA-302 | 风险矩阵 | 风险矩阵可视化展示 | P0 |
| TA-303 | 处置决策 | 确定风险处置策略 | P0 |

#### 2.4.5 安全措施

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| TA-401 | 目标生成 | 自动生成安全目标 | P0 |
| TA-402 | 需求生成 | 自动生成安全需求 | P0 |
| TA-403 | WP29控制映射 | 映射WP29安全控制措施 | P0 |
| TA-404 | 措施编辑 | 手动编辑安全措施 | P0 |

### 2.5 知识图谱模块

#### 2.5.1 图谱构建

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| KG-001 | 节点创建 | 创建资产节点 | P0 |
| KG-002 | 关系创建 | 创建资产间关系 | P0 |
| KG-003 | 图谱更新 | 增量更新图谱 | P0 |
| KG-004 | 图谱合并 | 合并多项目图谱 | P2 |

#### 2.5.2 图谱查询

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| KG-101 | 图谱可视化 | 可视化展示资产关系图谱 | P0 |
| KG-102 | 路径查询 | 查询资产间攻击路径 | P1 |
| KG-103 | 影响分析 | 分析资产受攻击的影响范围 | P1 |
| KG-104 | 关联查询 | 查询相关联资产 | P0 |

### 2.6 图表生成模块

#### 2.6.1 攻击树

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| CG-001 | 攻击树生成 | 自动生成攻击树图 | P0 |
| CG-002 | 攻击树编辑 | 编辑攻击树 | P1 |
| CG-003 | 攻击树导出 | 导出攻击树图片 | P0 |

#### 2.6.2 统计图表

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| CG-101 | 风险热力图 | 生成风险热力图 | P0 |
| CG-102 | 资产分布图 | 资产分类分布饼图 | P0 |
| CG-103 | 威胁分布图 | 威胁类型分布图 | P0 |
| CG-104 | 风险趋势图 | 风险等级趋势图 | P1 |

### 2.7 报告中心模块

#### 2.7.1 报告生成

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| RC-001 | 生成报告 | 生成完整TARA报告 | P0 |
| RC-002 | 报告预览 | 在线预览报告 | P0 |
| RC-003 | 报告下载 | 下载Excel格式报告 | P0 |
| RC-004 | 报告模板 | 自定义报告模板 | P2 |
| RC-005 | 增量报告 | 生成增量变更报告 | P2 |

#### 2.7.2 报告格式

报告必须严格遵循`MY25EV_Platform_IVI_TARA_Report.xlsx`的格式，包含以下Sheet：

| Sheet名称 | 内容描述 |
|-----------|---------|
| 封面 | 报告封面信息 |
| 相关定义 | 功能描述、项目边界、架构图、假设、术语表 |
| 资产列表 | 资产识别结果和安全属性 |
| 攻击树分析 | 攻击树图 |
| TARA分析结果 | 完整威胁分析和风险评估结果 |

#### 2.7.3 报告管理

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| RC-101 | 报告列表 | 查看所有已生成报告 | P0 |
| RC-102 | 报告版本 | 管理报告版本 | P0 |
| RC-103 | 报告分享 | 生成报告分享链接 | P1 |
| RC-104 | 报告审批 | 报告审批流程 | P2 |

### 2.8 智能体服务模块

#### 2.8.1 AI能力

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| AS-001 | 文档理解 | 多模态文档理解 | P0 |
| AS-002 | 资产提取 | 智能资产识别提取 | P0 |
| AS-003 | 威胁推理 | 威胁场景智能推理 | P0 |
| AS-004 | 风险评估 | 智能风险评估建议 | P0 |
| AS-005 | 措施建议 | 安全措施智能推荐 | P0 |
| AS-006 | 对话交互 | 支持自然语言交互 | P1 |

#### 2.8.2 模型配置

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| AS-101 | 模型选择 | 配置使用的AI模型 | P0 |
| AS-102 | 提示词管理 | 管理系统提示词 | P1 |
| AS-103 | 结果校准 | AI结果人工校准反馈 | P1 |

### 2.9 知识库服务模块

#### 2.9.1 威胁知识库

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| KB-001 | WP29威胁库 | WP29威胁类型库 | P0 |
| KB-002 | STRIDE威胁库 | STRIDE威胁模式库 | P0 |
| KB-003 | 攻击模式库 | 汽车攻击模式库 | P0 |
| KB-004 | 漏洞库 | 汽车相关漏洞库 | P1 |

#### 2.9.2 安全措施库

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| KB-101 | WP29控制库 | WP29安全控制措施库 | P0 |
| KB-102 | 最佳实践库 | 行业安全最佳实践 | P1 |
| KB-103 | 安全需求模板 | 安全需求模板库 | P1 |

#### 2.9.3 向量检索

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| KB-201 | 文档向量化 | 文档内容向量化存储 | P0 |
| KB-202 | 相似检索 | 相似内容检索 | P0 |
| KB-203 | 知识问答 | 基于知识库的问答 | P1 |

### 2.10 通知服务模块

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| NS-001 | 站内通知 | 系统站内消息通知 | P1 |
| NS-002 | 邮件通知 | 邮件通知 | P2 |
| NS-003 | 任务提醒 | 分析任务完成提醒 | P1 |
| NS-004 | 审批通知 | 审批流程通知 | P2 |

### 2.11 系统管理模块

| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|---------|---------|--------|
| SM-001 | 用户管理 | 用户增删改查 | P0 |
| SM-002 | 角色管理 | 角色权限配置 | P0 |
| SM-003 | 组织管理 | 组织架构管理 | P1 |
| SM-004 | 系统配置 | 系统参数配置 | P0 |
| SM-005 | 操作审计 | 操作日志审计 | P1 |
| SM-006 | 数据备份 | 数据备份恢复 | P1 |

---

## 3. 非功能需求

### 3.1 性能需求

| 需求ID | 需求描述 | 指标 |
|--------|---------|------|
| NFR-P01 | 页面响应时间 | 普通页面 < 2秒，复杂页面 < 5秒 |
| NFR-P02 | 文档解析速度 | 10页PDF < 30秒 |
| NFR-P03 | 报告生成速度 | 完整报告 < 60秒 |
| NFR-P04 | 并发用户数 | 支持100并发用户 |
| NFR-P05 | AI分析响应 | 单次分析 < 30秒 |

### 3.2 可用性需求

| 需求ID | 需求描述 | 指标 |
|--------|---------|------|
| NFR-A01 | 系统可用性 | 99.9% |
| NFR-A02 | 数据持久性 | 99.99% |
| NFR-A03 | 故障恢复时间 | RTO < 4小时, RPO < 1小时 |

### 3.3 可扩展性需求

| 需求ID | 需求描述 |
|--------|---------|
| NFR-S01 | 支持水平扩展，可通过增加节点提升处理能力 |
| NFR-S02 | 模块化设计，支持独立升级和替换 |
| NFR-S03 | 支持多租户架构 |

### 3.4 安全性需求

| 需求ID | 需求描述 |
|--------|---------|
| NFR-SEC01 | 用户认证采用JWT Token机制 |
| NFR-SEC02 | 敏感数据加密存储 |
| NFR-SEC03 | 接口通信使用HTTPS |
| NFR-SEC04 | 支持RBAC权限控制 |
| NFR-SEC05 | 操作审计日志 |

### 3.5 兼容性需求

| 需求ID | 需求描述 |
|--------|---------|
| NFR-C01 | 前端支持Chrome/Firefox/Edge最新版本 |
| NFR-C02 | 响应式设计，支持1920x1080及以上分辨率 |
| NFR-C03 | API遵循RESTful规范 |

---

## 4. 系统架构

### 4.1 总体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           用户层 (User Layer)                            │
│    ┌─────────────────────────────────────────────────────────────┐     │
│    │                  Web Browser (Chrome/Firefox/Edge)           │     │
│    └─────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          接入层 (Access Layer)                           │
│    ┌─────────────────────────────────────────────────────────────┐     │
│    │                         Nginx                                │     │
│    │              (负载均衡 / 反向代理 / SSL终止)                    │     │
│    └─────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
                    ┌────────────────┴────────────────┐
                    ▼                                 ▼
┌──────────────────────────────┐    ┌──────────────────────────────────────┐
│      前端服务 (Frontend)      │    │           后端服务 (Backend)          │
│  ┌────────────────────────┐  │    │  ┌──────────────────────────────┐   │
│  │    Vite + TypeScript   │  │    │  │      FastAPI Application     │   │
│  │      + TailwindCSS     │  │    │  │         (Uvicorn)            │   │
│  └────────────────────────┘  │    │  └──────────────────────────────┘   │
└──────────────────────────────┘    └──────────────────────────────────────┘
                                                      │
                    ┌─────────────────────────────────┼─────────────────────┐
                    │                                 │                     │
                    ▼                                 ▼                     ▼
┌─────────────────────────┐    ┌─────────────────────────┐    ┌─────────────────────────┐
│    消息队列 (Kafka)      │    │    缓存 (Redis)          │    │   对象存储 (MinIO)       │
│  ┌───────────────────┐  │    │  ┌───────────────────┐  │    │  ┌───────────────────┐  │
│  │  任务队列          │  │    │  │  会话缓存          │  │    │  │  文档存储          │  │
│  │  事件流           │  │    │  │  数据缓存          │  │    │  │  报告存储          │  │
│  │  异步消息         │  │    │  │  分布式锁          │  │    │  │  图片存储          │  │
│  └───────────────────┘  │    │  └───────────────────┘  │    │  └───────────────────┘  │
└─────────────────────────┘    └─────────────────────────┘    └─────────────────────────┘
                    │                                 │
                    ▼                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          数据层 (Data Layer)                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   MySQL     │  │   Neo4j     │  │   Milvus    │  │ElasticSearch│    │
│  │  业务数据    │  │  知识图谱    │  │  向量存储    │  │  全文检索    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       外部服务 (External Services)                        │
│    ┌─────────────────────────────────────────────────────────────┐     │
│    │                   阿里云百炼 Qwen API                         │     │
│    │      (qwen-vl-max / qwen-max / qwen-ocr / text-embedding)   │     │
│    └─────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 后端服务架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       FastAPI Application                                │
├─────────────────────────────────────────────────────────────────────────┤
│                           API Layer                                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │
│  │ Project  │ │ Document │ │  Asset   │ │ Threat   │ │  Report  │     │
│  │   API    │ │   API    │ │   API    │ │   API    │ │   API    │     │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │
│  │Knowledge │ │  Agent   │ │   User   │ │  System  │ │  Graph   │     │
│  │   API    │ │   API    │ │   API    │ │   API    │ │   API    │     │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │
├─────────────────────────────────────────────────────────────────────────┤
│                         Service Layer                                    │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│  │  ProjectService  │ │ DocumentService  │ │   AssetService   │        │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘        │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│  │  ThreatService   │ │  ReportService   │ │ KnowledgeService │        │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘        │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│  │   AgentService   │ │   GraphService   │ │   UserService    │        │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘        │
├─────────────────────────────────────────────────────────────────────────┤
│                       Infrastructure Layer                               │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│  │  DatabaseClient  │ │   CacheClient    │ │   QueueClient    │        │
│  │     (MySQL)      │ │     (Redis)      │ │     (Kafka)      │        │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘        │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐        │
│  │   GraphClient    │ │   VectorClient   │ │   SearchClient   │        │
│  │     (Neo4j)      │ │     (Milvus)     │ │ (ElasticSearch)  │        │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘        │
│  ┌──────────────────┐ ┌──────────────────┐                             │
│  │  StorageClient   │ │     AIClient     │                             │
│  │     (MinIO)      │ │   (Qwen API)     │                             │
│  └──────────────────┘ └──────────────────┘                             │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 前端架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Frontend Application                              │
├─────────────────────────────────────────────────────────────────────────┤
│                           Pages (路由页面)                                │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │
│  │Dashboard │ │ Projects │ │ Analysis │ │  Reports │ │ Settings │     │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │
├─────────────────────────────────────────────────────────────────────────┤
│                         Components (组件)                                │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │  Common: Button, Input, Modal, Table, Card, Toast, Loading     │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │  Business: AssetList, ThreatTable, RiskMatrix, AttackTree      │    │
│  │           GraphViewer, ReportPreview, DocumentUploader         │    │
│  └────────────────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────────────┤
│                           State Management                               │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    Zustand / React Query                         │  │
│  └──────────────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────┤
│                              Services                                    │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐     │
│  │   API    │ │   Auth   │ │  Storage │ │  WebSocket│ │  Utils   │     │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.4 数据流架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         TARA Analysis Data Flow                          │
└─────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
  │ 文档上传 │────▶│ 文档解析 │────▶│ 资产识别 │────▶│ 威胁分析 │────▶│ 报告生成 │
  └─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
       │               │               │               │               │
       ▼               ▼               ▼               ▼               ▼
  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
  │  MinIO  │     │Qwen-VL  │     │ Qwen-Max│     │ Qwen-Max│     │  Excel  │
  │  存储   │     │  OCR    │     │   NLP   │     │  推理    │     │  生成   │
  └─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
                       │               │               │
                       ▼               ▼               ▼
                  ┌─────────┐     ┌─────────┐     ┌─────────┐
                  │  MySQL  │     │  Neo4j  │     │ Milvus  │
                  │ 结构化  │     │ 知识图谱│     │ 向量库  │
                  └─────────┘     └─────────┘     └─────────┘
```

---

## 5. 模块设计

### 5.1 项目管理模块

#### 5.1.1 功能说明

项目管理模块负责TARA分析项目的全生命周期管理，包括项目创建、版本管理、团队协作等功能。

#### 5.1.2 核心流程

```
┌──────────────────────────────────────────────────────────────────────┐
│                         项目创建流程                                   │
└──────────────────────────────────────────────────────────────────────┘

  ┌─────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────┐
  │ 填写基本 │────▶│ 配置分析参数 │────▶│ 邀请团队成员 │────▶│ 创建完成 │
  │ 信息    │     │ (可选)       │     │ (可选)       │     │         │
  └─────────┘     └─────────────┘     └─────────────┘     └─────────┘
```

#### 5.1.3 项目状态机

```
                    ┌─────────┐
                    │  草稿   │
                    └────┬────┘
                         │ 开始分析
                         ▼
┌─────────┐        ┌─────────┐        ┌─────────┐
│  归档   │◀───────│ 分析中  │───────▶│ 已完成  │
└─────────┘  归档  └────┬────┘  完成   └────┬────┘
     ▲                  │                   │
     │                  │ 暂停              │ 重新分析
     │                  ▼                   │
     │             ┌─────────┐              │
     └─────────────│  暂停   │◀─────────────┘
          归档     └─────────┘
```

### 5.2 文档解析模块

#### 5.2.1 功能说明

文档解析模块负责处理用户上传的各类文档，通过OCR、多模态模型等技术提取结构化信息。

#### 5.2.2 支持的文档类型

| 文档类型 | 扩展名 | 解析方法 |
|---------|-------|---------|
| Word文档 | .doc/.docx | python-docx + 图片OCR |
| PDF文档 | .pdf | PyMuPDF + 图片OCR |
| Excel表格 | .xls/.xlsx | openpyxl |
| PPT演示 | .ppt/.pptx | python-pptx + 图片OCR |
| 图片 | .png/.jpg/.jpeg | Qwen-VL多模态理解 |

#### 5.2.3 解析流程

```
┌──────────────────────────────────────────────────────────────────────┐
│                         文档解析流程                                   │
└──────────────────────────────────────────────────────────────────────┘

  ┌─────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────┐
  │ 文档上传 │────▶│ 类型识别    │────▶│ 内容提取    │────▶│ 结果存储 │
  └─────────┘     └─────────────┘     └──────┬──────┘     └─────────┘
                                             │
                         ┌───────────────────┼───────────────────┐
                         ▼                   ▼                   ▼
                    ┌─────────┐         ┌─────────┐         ┌─────────┐
                    │文本提取 │         │表格解析 │         │图像理解 │
                    └─────────┘         └─────────┘         └─────────┘
                         │                   │                   │
                         └───────────────────┴───────────────────┘
                                             │
                                             ▼
                                      ┌─────────────┐
                                      │  结构化输出  │
                                      └─────────────┘
```

#### 5.2.4 架构图解析

使用Qwen-VL多模态模型解析架构图，提取以下信息：

- 组件/模块列表
- 接口定义
- 数据流向
- 通信协议

### 5.3 资产识别模块

#### 5.3.1 功能说明

资产识别模块从解析结果中自动识别和分类资产，并标注安全属性。

#### 5.3.2 资产分类体系

```
资产 (Asset)
├── 硬件资产 (Hardware)
│   ├── 处理器 (Processor): SOC, MCU
│   ├── 存储器 (Memory): DDR, Flash, eMMC
│   ├── 通信模块 (Communication): BT, WiFi, 4G/5G
│   └── 传感器 (Sensor): Camera, Radar, LiDAR
├── 软件资产 (Software)
│   ├── 系统软件 (System): OS, Bootloader, TEE
│   ├── 中间件 (Middleware): AUTOSAR, ROS
│   └── 应用软件 (Application): Apps, Services
├── 数据资产 (Data)
│   ├── 配置数据 (Config): 系统配置、用户设置
│   ├── 用户数据 (User): 个人信息、使用记录
│   ├── 密钥数据 (Key): 加密密钥、证书
│   └── 日志数据 (Log): 系统日志、诊断数据
├── 接口资产 (Interface)
│   ├── 有线接口 (Wired): CAN, Ethernet, USB, UART, JTAG
│   └── 无线接口 (Wireless): BT, WiFi, NFC
└── 外部实体 (External)
    ├── 外部设备 (Device): OBD设备、手机
    └── 外部服务 (Service): TSP云服务、第三方服务
```

#### 5.3.3 安全属性定义

| 属性 | 英文 | 说明 |
|-----|------|-----|
| 真实性 | Authenticity | 确保实体身份真实可信 |
| 完整性 | Integrity | 确保数据未被未授权修改 |
| 不可抵赖性 | Non-repudiation | 确保行为可追溯、不可否认 |
| 机密性 | Confidentiality | 确保数据不被未授权访问 |
| 可用性 | Availability | 确保服务持续可用 |
| 授权性 | Authorization | 确保访问经过适当授权 |

### 5.4 威胁风险分析模块

#### 5.4.1 STRIDE威胁模型

| 威胁类型 | 英文 | 说明 | 对应安全属性 |
|---------|------|-----|-------------|
| 欺骗 | Spoofing | 冒充其他实体 | 真实性 |
| 篡改 | Tampering | 未授权修改数据 | 完整性 |
| 抵赖 | Repudiation | 否认执行过的操作 | 不可抵赖性 |
| 信息泄露 | Information Disclosure | 数据泄露给未授权方 | 机密性 |
| 拒绝服务 | Denial of Service | 使服务不可用 | 可用性 |
| 权限提升 | Elevation of Privilege | 获取超出授权的权限 | 授权性 |

#### 5.4.2 攻击可行性评估

基于ISO 21434的攻击可行性评估方法：

| 参数 | 取值 | 说明 |
|-----|------|-----|
| 攻击向量(V) | Physical/Local/Adjacent/Network | 攻击发起位置 |
| 攻击复杂度(C) | High/Low | 攻击实施难度 |
| 权限需求(P) | None/Low/High | 所需初始权限 |
| 用户交互(U) | Required/None | 是否需要用户配合 |

攻击可行性等级计算公式：
```
AF = f(V, C, P, U)
```

| 等级 | 描述 |
|-----|------|
| 高 (High) | 攻击容易实施 |
| 中 (Medium) | 攻击需要一定条件 |
| 低 (Low) | 攻击较难实施 |
| 极低 (Very Low) | 攻击非常困难 |

#### 5.4.3 影响等级评估

| 维度 | 等级 | 说明 |
|-----|------|-----|
| Safety (S) | S0-S3 | 人身安全影响 |
| Financial (F) | F0-F3 | 经济损失影响 |
| Operational (O) | O0-O3 | 运营影响 |
| Privacy (P) | P0-P3 | 隐私和法规影响 |

综合影响等级 = max(S, F, O, P)

#### 5.4.4 风险等级矩阵

```
              │ 影响等级
  攻击可行性  │ 可忽略(0) │ 中等(1) │ 重大(2) │ 严重(3)
─────────────┼───────────┼─────────┼─────────┼─────────
  高(3)      │    2      │    3    │    4    │    5
  中(2)      │    1      │    2    │    3    │    4
  低(1)      │    1      │    1    │    2    │    3
  极低(0)    │    1      │    1    │    1    │    2

风险等级: 1=可接受, 2=低, 3=中, 4=高, 5=严重
```

#### 5.4.5 风险处置决策

| 风险等级 | 处置策略 |
|---------|---------|
| 1 (可接受) | 接受风险，无需额外措施 |
| 2 (低) | 考虑降低风险，非强制 |
| 3 (中) | 应采取措施降低风险 |
| 4 (高) | 必须采取措施降低风险 |
| 5 (严重) | 必须立即采取强有力措施 |

### 5.5 知识图谱模块

#### 5.5.1 图谱数据模型

**节点类型：**

```cypher
// 资产节点
(:Asset {
  id: string,
  name: string,
  category: string,
  subcategory: string,
  description: string,
  security_attributes: list
})

// 威胁节点
(:Threat {
  id: string,
  name: string,
  stride_type: string,
  description: string,
  attack_path: string
})

// 安全措施节点
(:Mitigation {
  id: string,
  name: string,
  description: string,
  wp29_control: string
})
```

**关系类型：**

```cypher
// 资产间关系
(:Asset)-[:CONNECTS_TO {protocol: string}]->(:Asset)
(:Asset)-[:CONTAINS]->(:Asset)
(:Asset)-[:DEPENDS_ON]->(:Asset)

// 威胁关系
(:Threat)-[:TARGETS]->(:Asset)
(:Threat)-[:EXPLOITS {attack_vector: string}]->(:Asset)

// 措施关系
(:Mitigation)-[:MITIGATES]->(:Threat)
(:Asset)-[:PROTECTED_BY]->(:Mitigation)
```

#### 5.5.2 图谱可视化

使用D3.js或Cytoscape.js实现交互式图谱可视化：

- 力导向布局展示资产关系
- 节点颜色区分资产类型
- 边样式区分关系类型
- 支持缩放、拖拽、搜索
- 点击节点查看详情

### 5.6 报告生成模块

#### 5.6.1 报告结构

严格遵循`MY25EV_Platform_IVI_TARA_Report.xlsx`格式：

**Sheet 1: 封面**
- 文档编号、版本
- 报告标题
- 编制/审核/会签/批准信息

**Sheet 2: 相关定义**
- 功能描述
- 项目边界
- 系统架构图（插入图片）
- 软件架构图（插入图片）
- 相关项假设表
- 术语表

**Sheet 3: 资产列表**

| 列名 | 说明 |
|-----|------|
| 资产ID | 资产唯一标识 |
| 资产名称 | 资产名称 |
| 分类 | 资产分类 |
| 备注 | 资产描述 |
| 真实性 | √ 或空 |
| 完整性 | √ 或空 |
| 不可抵赖性 | √ 或空 |
| 机密性 | √ 或空 |
| 可用性 | √ 或空 |
| 权限 | √ 或空 |

**Sheet 4: 攻击树分析**
- 攻击树图（插入图片）

**Sheet 5: TARA分析结果**

| 列组 | 列名 |
|-----|------|
| 资产识别 | 资产ID、资产名称、细分类、分类 |
| 威胁&损害场景 | 安全属性、STRIDE模型、潜在威胁和损害场景 |
| 威胁分析 | 攻击路径、来源、WP29映射、攻击向量、复杂度、权限需求、用户交互、可行性计算 |
| 影响分析 | Safety、Financial、Operational、Privacy、影响等级计算 |
| 风险评估 | 风险等级（自动计算） |
| 风险处置 | 处置决策 |
| 风险缓解 | 安全目标、安全需求、WP29控制映射 |

#### 5.6.2 自动计算列

以下列需要根据公式自动计算：

1. **攻击可行性计算**: 根据V/C/P/U参数计算
2. **影响等级计算**: max(S, F, O, P)
3. **风险等级**: 根据攻击可行性和影响等级查表

---

## 6. 数据模型

### 6.1 MySQL数据模型

#### 6.1.1 用户与权限

```sql
-- 用户表
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    display_name VARCHAR(100),
    avatar_url VARCHAR(500),
    status ENUM('active', 'inactive', 'locked') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 角色表
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    description VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 用户角色关联表
CREATE TABLE user_roles (
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    PRIMARY KEY (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 权限表
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(100) NOT NULL UNIQUE,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(255),
    resource VARCHAR(50),
    action VARCHAR(50)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 角色权限关联表
CREATE TABLE role_permissions (
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    PRIMARY KEY (role_id, permission_id),
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.2 项目管理

```sql
-- 项目表
CREATE TABLE projects (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE,
    description TEXT,
    status ENUM('draft', 'analyzing', 'paused', 'completed', 'archived') DEFAULT 'draft',
    owner_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id),
    INDEX idx_status (status),
    INDEX idx_owner (owner_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 项目版本表
CREATE TABLE project_versions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    version VARCHAR(20) NOT NULL,
    description TEXT,
    status ENUM('draft', 'active', 'archived') DEFAULT 'draft',
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id),
    UNIQUE KEY uk_project_version (project_id, version)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 项目成员表
CREATE TABLE project_members (
    project_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    role ENUM('owner', 'admin', 'editor', 'viewer') DEFAULT 'viewer',
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (project_id, user_id),
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 项目配置表
CREATE TABLE project_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL UNIQUE,
    item_name VARCHAR(200),
    item_boundary TEXT,
    functional_description TEXT,
    config_json JSON,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.3 文档管理

```sql
-- 文档表
CREATE TABLE documents (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    version_id BIGINT,
    name VARCHAR(255) NOT NULL,
    original_name VARCHAR(255) NOT NULL,
    file_type VARCHAR(20) NOT NULL,
    file_size BIGINT,
    storage_path VARCHAR(500) NOT NULL,
    category ENUM('architecture', 'function_list', 'communication_matrix',
                  'interface_definition', 'asset_list', 'security_requirement',
                  'security_measure', 'other') DEFAULT 'other',
    parse_status ENUM('pending', 'parsing', 'completed', 'failed') DEFAULT 'pending',
    parse_result JSON,
    uploaded_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (version_id) REFERENCES project_versions(id),
    FOREIGN KEY (uploaded_by) REFERENCES users(id),
    INDEX idx_project (project_id),
    INDEX idx_status (parse_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.4 资产管理

```sql
-- 资产表
CREATE TABLE assets (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    version_id BIGINT,
    asset_id VARCHAR(50) NOT NULL,
    name VARCHAR(200) NOT NULL,
    category VARCHAR(50) NOT NULL,
    subcategory VARCHAR(50),
    description TEXT,
    remarks TEXT,
    source_document_id BIGINT,
    authenticity BOOLEAN DEFAULT FALSE,
    integrity BOOLEAN DEFAULT FALSE,
    non_repudiation BOOLEAN DEFAULT FALSE,
    confidentiality BOOLEAN DEFAULT FALSE,
    availability BOOLEAN DEFAULT FALSE,
    authorization BOOLEAN DEFAULT FALSE,
    is_ai_generated BOOLEAN DEFAULT TRUE,
    is_confirmed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (version_id) REFERENCES project_versions(id),
    FOREIGN KEY (source_document_id) REFERENCES documents(id),
    UNIQUE KEY uk_project_asset (project_id, version_id, asset_id),
    INDEX idx_category (category)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 资产关系表
CREATE TABLE asset_relations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    source_asset_id BIGINT NOT NULL,
    target_asset_id BIGINT NOT NULL,
    relation_type VARCHAR(50) NOT NULL,
    protocol VARCHAR(50),
    description TEXT,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (source_asset_id) REFERENCES assets(id) ON DELETE CASCADE,
    FOREIGN KEY (target_asset_id) REFERENCES assets(id) ON DELETE CASCADE,
    INDEX idx_source (source_asset_id),
    INDEX idx_target (target_asset_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.5 威胁与风险

```sql
-- 威胁场景表
CREATE TABLE threat_scenarios (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    version_id BIGINT,
    asset_id BIGINT NOT NULL,
    threat_id VARCHAR(50) NOT NULL,
    security_attribute VARCHAR(50) NOT NULL,
    stride_type ENUM('S', 'T', 'R', 'I', 'D', 'E') NOT NULL,
    threat_description TEXT NOT NULL,
    damage_scenario TEXT,
    attack_path TEXT,
    source_reference TEXT,
    wp29_mapping VARCHAR(100),

    -- 攻击可行性参数
    attack_vector ENUM('Physical', 'Local', 'Adjacent', 'Network'),
    attack_complexity ENUM('High', 'Low'),
    privileges_required ENUM('None', 'Low', 'High'),
    user_interaction ENUM('Required', 'None'),
    attack_feasibility ENUM('High', 'Medium', 'Low', 'Very Low'),
    attack_feasibility_value INT,

    -- 影响分析
    impact_safety ENUM('S0', 'S1', 'S2', 'S3'),
    impact_financial ENUM('F0', 'F1', 'F2', 'F3'),
    impact_operational ENUM('O0', 'O1', 'O2', 'O3'),
    impact_privacy ENUM('P0', 'P1', 'P2', 'P3'),
    impact_level ENUM('Negligible', 'Moderate', 'Major', 'Severe'),
    impact_level_value INT,

    -- 风险评估
    risk_level INT,
    risk_level_label VARCHAR(20),

    -- 风险处置
    treatment_decision ENUM('Accept', 'Reduce', 'Avoid', 'Transfer'),

    is_ai_generated BOOLEAN DEFAULT TRUE,
    is_confirmed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (version_id) REFERENCES project_versions(id),
    FOREIGN KEY (asset_id) REFERENCES assets(id) ON DELETE CASCADE,
    INDEX idx_asset (asset_id),
    INDEX idx_risk_level (risk_level)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 安全措施表
CREATE TABLE security_mitigations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    threat_id BIGINT NOT NULL,
    security_goal TEXT,
    security_requirement TEXT,
    wp29_control_mapping VARCHAR(100),
    implementation_status ENUM('planned', 'in_progress', 'implemented', 'verified') DEFAULT 'planned',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (threat_id) REFERENCES threat_scenarios(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.6 报告管理

```sql
-- 报告表
CREATE TABLE reports (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    version_id BIGINT,
    report_number VARCHAR(100),
    title VARCHAR(255) NOT NULL,
    report_version VARCHAR(20),
    status ENUM('generating', 'completed', 'failed') DEFAULT 'generating',
    storage_path VARCHAR(500),
    file_size BIGINT,
    generated_by BIGINT NOT NULL,
    author VARCHAR(100),
    reviewer VARCHAR(100),
    approver VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (version_id) REFERENCES project_versions(id),
    FOREIGN KEY (generated_by) REFERENCES users(id),
    INDEX idx_project (project_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 6.1.7 知识库

```sql
-- WP29威胁库
CREATE TABLE kb_wp29_threats (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) NOT NULL UNIQUE,
    category VARCHAR(100),
    subcategory VARCHAR(100),
    threat_description_en TEXT,
    threat_description_zh TEXT,
    mitigation_en TEXT,
    mitigation_zh TEXT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 攻击模式库
CREATE TABLE kb_attack_patterns (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    pattern_id VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    prerequisites TEXT,
    attack_steps TEXT,
    mitigations TEXT,
    related_cwe JSON,
    related_capec VARCHAR(100)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 安全需求模板库
CREATE TABLE kb_security_requirements (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    category VARCHAR(50),
    requirement_template TEXT NOT NULL,
    description TEXT,
    related_stride VARCHAR(10),
    related_wp29 JSON
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 6.2 Neo4j图数据模型

#### 6.2.1 节点Schema

```cypher
// 项目节点
CREATE CONSTRAINT project_id IF NOT EXISTS
FOR (p:Project) REQUIRE p.id IS UNIQUE;

// 资产节点
CREATE CONSTRAINT asset_id IF NOT EXISTS
FOR (a:Asset) REQUIRE a.id IS UNIQUE;

// 威胁节点
CREATE CONSTRAINT threat_id IF NOT EXISTS
FOR (t:Threat) REQUIRE t.id IS UNIQUE;

// 安全措施节点
CREATE CONSTRAINT mitigation_id IF NOT EXISTS
FOR (m:Mitigation) REQUIRE m.id IS UNIQUE;
```

#### 6.2.2 关系Schema

```cypher
// 资产关系类型
// (:Asset)-[:CONNECTS_TO {protocol, direction}]->(:Asset)
// (:Asset)-[:CONTAINS]->(:Asset)
// (:Asset)-[:DEPENDS_ON]->(:Asset)
// (:Asset)-[:COMMUNICATES_WITH {bus_type, message_type}]->(:Asset)

// 威胁关系类型
// (:Threat)-[:TARGETS]->(:Asset)
// (:Threat)-[:LEADS_TO]->(:Threat)

// 措施关系类型
// (:Mitigation)-[:MITIGATES]->(:Threat)
// (:Asset)-[:PROTECTED_BY]->(:Mitigation)

// 项目关系类型
// (:Project)-[:HAS_ASSET]->(:Asset)
// (:Project)-[:HAS_THREAT]->(:Threat)
```

### 6.3 Milvus向量数据模型

```python
# 文档向量集合
document_collection = {
    "name": "document_embeddings",
    "fields": [
        {"name": "id", "type": "INT64", "is_primary": True},
        {"name": "project_id", "type": "INT64"},
        {"name": "document_id", "type": "INT64"},
        {"name": "chunk_index", "type": "INT32"},
        {"name": "content", "type": "VARCHAR", "max_length": 65535},
        {"name": "embedding", "type": "FLOAT_VECTOR", "dim": 1536}
    ],
    "index": {
        "field_name": "embedding",
        "index_type": "IVF_FLAT",
        "metric_type": "COSINE",
        "params": {"nlist": 1024}
    }
}

# 知识库向量集合
knowledge_collection = {
    "name": "knowledge_embeddings",
    "fields": [
        {"name": "id", "type": "INT64", "is_primary": True},
        {"name": "knowledge_type", "type": "VARCHAR", "max_length": 50},
        {"name": "source_id", "type": "INT64"},
        {"name": "content", "type": "VARCHAR", "max_length": 65535},
        {"name": "embedding", "type": "FLOAT_VECTOR", "dim": 1536}
    ]
}
```

---

## 7. API设计

### 7.1 API规范

- 遵循RESTful设计原则
- 使用JSON作为数据交换格式
- 统一响应格式
- JWT Token认证
- 版本控制: `/api/v1/`

### 7.2 统一响应格式

```json
// 成功响应
{
    "code": 0,
    "message": "success",
    "data": { ... },
    "timestamp": 1705401600000
}

// 分页响应
{
    "code": 0,
    "message": "success",
    "data": {
        "items": [ ... ],
        "total": 100,
        "page": 1,
        "page_size": 20
    },
    "timestamp": 1705401600000
}

// 错误响应
{
    "code": 40001,
    "message": "Invalid parameter: project_id is required",
    "data": null,
    "timestamp": 1705401600000
}
```

### 7.3 错误码定义

| 错误码范围 | 说明 |
|-----------|------|
| 0 | 成功 |
| 10000-19999 | 系统错误 |
| 20000-29999 | 认证授权错误 |
| 30000-39999 | 参数校验错误 |
| 40000-49999 | 业务错误 |
| 50000-59999 | 外部服务错误 |

### 7.4 核心API列表

#### 7.4.1 认证API

| 方法 | 路径 | 说明 |
|-----|------|------|
| POST | /api/v1/auth/login | 用户登录 |
| POST | /api/v1/auth/logout | 用户登出 |
| POST | /api/v1/auth/refresh | 刷新Token |
| GET | /api/v1/auth/profile | 获取当前用户信息 |

#### 7.4.2 项目API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects | 获取项目列表 |
| POST | /api/v1/projects | 创建项目 |
| GET | /api/v1/projects/{id} | 获取项目详情 |
| PUT | /api/v1/projects/{id} | 更新项目 |
| DELETE | /api/v1/projects/{id} | 删除项目 |
| POST | /api/v1/projects/{id}/versions | 创建版本 |
| GET | /api/v1/projects/{id}/versions | 获取版本列表 |
| GET | /api/v1/projects/{id}/members | 获取项目成员 |
| POST | /api/v1/projects/{id}/members | 添加项目成员 |

#### 7.4.3 文档API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects/{id}/documents | 获取文档列表 |
| POST | /api/v1/projects/{id}/documents | 上传文档 |
| GET | /api/v1/documents/{id} | 获取文档详情 |
| DELETE | /api/v1/documents/{id} | 删除文档 |
| POST | /api/v1/documents/{id}/parse | 解析文档 |
| GET | /api/v1/documents/{id}/parse-result | 获取解析结果 |
| GET | /api/v1/documents/{id}/preview | 预览文档 |

#### 7.4.4 资产API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects/{id}/assets | 获取资产列表 |
| POST | /api/v1/projects/{id}/assets | 创建资产 |
| POST | /api/v1/projects/{id}/assets/identify | AI识别资产 |
| GET | /api/v1/assets/{id} | 获取资产详情 |
| PUT | /api/v1/assets/{id} | 更新资产 |
| DELETE | /api/v1/assets/{id} | 删除资产 |
| POST | /api/v1/assets/{id}/confirm | 确认资产 |
| GET | /api/v1/projects/{id}/assets/graph | 获取资产关系图 |

#### 7.4.5 威胁分析API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects/{id}/threats | 获取威胁列表 |
| POST | /api/v1/projects/{id}/threats | 创建威胁 |
| POST | /api/v1/projects/{id}/threats/analyze | AI分析威胁 |
| GET | /api/v1/threats/{id} | 获取威胁详情 |
| PUT | /api/v1/threats/{id} | 更新威胁 |
| DELETE | /api/v1/threats/{id} | 删除威胁 |
| POST | /api/v1/threats/{id}/assess | 评估风险 |
| GET | /api/v1/projects/{id}/risk-matrix | 获取风险矩阵 |

#### 7.4.6 报告API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects/{id}/reports | 获取报告列表 |
| POST | /api/v1/projects/{id}/reports/generate | 生成报告 |
| GET | /api/v1/reports/{id} | 获取报告详情 |
| GET | /api/v1/reports/{id}/download | 下载报告 |
| GET | /api/v1/reports/{id}/preview | 预览报告 |

#### 7.4.7 知识图谱API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/projects/{id}/graph | 获取知识图谱 |
| GET | /api/v1/graph/nodes/{id} | 获取节点详情 |
| GET | /api/v1/graph/paths | 查询路径 |
| GET | /api/v1/graph/neighbors/{id} | 获取相邻节点 |

#### 7.4.8 智能体API

| 方法 | 路径 | 说明 |
|-----|------|------|
| POST | /api/v1/agent/chat | 对话交互 |
| POST | /api/v1/agent/analyze/document | 文档分析 |
| POST | /api/v1/agent/analyze/architecture | 架构分析 |
| POST | /api/v1/agent/suggest/threats | 威胁建议 |
| POST | /api/v1/agent/suggest/mitigations | 措施建议 |

#### 7.4.9 知识库API

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /api/v1/knowledge/wp29-threats | 获取WP29威胁库 |
| GET | /api/v1/knowledge/attack-patterns | 获取攻击模式库 |
| GET | /api/v1/knowledge/search | 知识检索 |
| POST | /api/v1/knowledge/qa | 知识问答 |

### 7.5 WebSocket API

```
WebSocket Endpoint: /ws/v1/notifications

// 消息格式
{
    "type": "task_progress" | "task_complete" | "notification",
    "data": { ... }
}

// 任务进度消息
{
    "type": "task_progress",
    "data": {
        "task_id": "xxx",
        "task_type": "document_parse" | "threat_analyze" | "report_generate",
        "progress": 50,
        "message": "正在解析文档..."
    }
}
```

---

## 8. 集成设计

### 8.1 阿里云百炼Qwen API集成

#### 8.1.1 使用的模型

| 模型 | 用途 | 说明 |
|-----|------|------|
| qwen-vl-max | 多模态理解 | 架构图解析、图片OCR |
| qwen-max | 文本生成 | 威胁分析、安全措施生成 |
| qwen-ocr | OCR识别 | 文档文字识别 |
| text-embedding-v3 | 向量嵌入 | 文档/知识库向量化 |

#### 8.1.2 API调用封装

```python
# AI客户端接口定义
class AIClient:
    async def chat_completion(
        self,
        messages: List[Message],
        model: str = "qwen-max",
        temperature: float = 0.7
    ) -> str:
        """文本对话补全"""
        pass

    async def vision_completion(
        self,
        image_url: str,
        prompt: str,
        model: str = "qwen-vl-max"
    ) -> str:
        """多模态视觉理解"""
        pass

    async def ocr(
        self,
        image_url: str,
        model: str = "qwen-ocr"
    ) -> str:
        """OCR文字识别"""
        pass

    async def embedding(
        self,
        text: str,
        model: str = "text-embedding-v3"
    ) -> List[float]:
        """文本向量化"""
        pass
```

#### 8.1.3 提示词设计

**资产识别提示词**:
```
你是一个汽车网络安全专家，专门负责TARA分析中的资产识别工作。
请根据以下文档内容，识别其中的资产信息。

资产分类包括：
- 硬件资产：处理器、存储器、通信模块、传感器等
- 软件资产：操作系统、中间件、应用软件等
- 数据资产：配置数据、用户数据、密钥数据、日志数据等
- 接口资产：有线接口、无线接口等
- 外部实体：外部设备、外部服务等

对于每个识别的资产，请提供：
1. 资产ID（如P001, S001, D001等）
2. 资产名称
3. 资产分类
4. 资产描述
5. 安全属性（真实性、完整性、不可抵赖性、机密性、可用性、授权性）

请以JSON格式输出。
```

**威胁分析提示词**:
```
你是一个汽车网络安全专家，专门负责TARA分析中的威胁识别工作。
请根据以下资产信息，基于STRIDE模型识别潜在威胁。

STRIDE模型包括：
- S(Spoofing)欺骗：冒充其他实体
- T(Tampering)篡改：未授权修改数据
- R(Repudiation)抵赖：否认执行过的操作
- I(Information Disclosure)信息泄露：数据泄露给未授权方
- D(Denial of Service)拒绝服务：使服务不可用
- E(Elevation of Privilege)权限提升：获取超出授权的权限

对于每个威胁，请提供：
1. 威胁的STRIDE类型
2. 威胁描述
3. 损害场景
4. 攻击路径
5. 建议的安全措施

请以JSON格式输出。
```

### 8.2 文档解析集成

#### 8.2.1 PDF解析

```python
# 使用PyMuPDF解析PDF
import fitz

class PDFParser:
    def parse(self, file_path: str) -> ParseResult:
        doc = fitz.open(file_path)
        result = ParseResult()

        for page_num, page in enumerate(doc):
            # 提取文本
            text = page.get_text()
            result.add_text(page_num, text)

            # 提取图片
            for img in page.get_images():
                image_data = self.extract_image(doc, img)
                result.add_image(page_num, image_data)

            # 提取表格
            tables = page.find_tables()
            for table in tables:
                result.add_table(page_num, table.extract())

        return result
```

#### 8.2.2 Excel解析

```python
# 使用openpyxl解析Excel
from openpyxl import load_workbook

class ExcelParser:
    def parse(self, file_path: str) -> ParseResult:
        wb = load_workbook(file_path)
        result = ParseResult()

        for sheet_name in wb.sheetnames:
            ws = wb[sheet_name]

            # 提取表格数据
            data = []
            for row in ws.iter_rows(values_only=True):
                data.append(list(row))

            result.add_sheet(sheet_name, data)

        return result
```

### 8.3 Excel报告生成

```python
from openpyxl import Workbook
from openpyxl.styles import Font, Alignment, Border, PatternFill

class ReportGenerator:
    def generate(self, project: Project) -> str:
        wb = Workbook()

        # 创建各Sheet
        self._create_cover_sheet(wb, project)
        self._create_definition_sheet(wb, project)
        self._create_asset_sheet(wb, project)
        self._create_attack_tree_sheet(wb, project)
        self._create_tara_result_sheet(wb, project)

        # 保存文件
        file_path = f"/reports/{project.id}/TARA_Report.xlsx"
        wb.save(file_path)
        return file_path

    def _create_tara_result_sheet(self, wb: Workbook, project: Project):
        ws = wb.create_sheet("TARA分析结果")

        # 设置表头
        headers = [
            "资产ID", "资产名称", "细分类", "分类", "安全属性", "STRIDE模型",
            "潜在威胁和损害场景", "攻击路径", "来源", "WP29映射",
            "攻击向量", "攻击复杂度", "权限需求", "用户交互", "可行性计算",
            "Safety", "Financial", "Operational", "Privacy", "影响等级",
            "风险等级", "处置决策", "安全目标", "安全需求", "WP29控制"
        ]

        for col, header in enumerate(headers, 1):
            ws.cell(row=1, column=col, value=header)

        # 填充数据（包含公式的自动计算列）
        for row, threat in enumerate(project.threats, 2):
            # ... 填充数据

            # 攻击可行性计算公式
            ws.cell(row=row, column=15).value = \
                f'=_calculate_feasibility(K{row},L{row},M{row},N{row})'

            # 影响等级计算公式
            ws.cell(row=row, column=20).value = \
                f'=MAX(P{row},Q{row},R{row},S{row})'

            # 风险等级计算公式
            ws.cell(row=row, column=21).value = \
                f'=_calculate_risk(O{row},T{row})'
```

---

## 9. 安全设计

### 9.1 认证与授权

#### 9.1.1 JWT Token认证

```python
# JWT配置
JWT_CONFIG = {
    "algorithm": "HS256",
    "access_token_expire_minutes": 60,
    "refresh_token_expire_days": 7
}

# Token结构
{
    "sub": "user_id",
    "username": "xxx",
    "roles": ["admin", "analyst"],
    "exp": 1705401600,
    "iat": 1705398000
}
```

#### 9.1.2 RBAC权限模型

```
角色定义:
- admin: 系统管理员，拥有所有权限
- analyst: 安全分析师，可以创建项目、执行分析
- reviewer: 评审人员，可以查看和评审报告
- viewer: 只读用户，只能查看

权限定义:
- project:create, project:read, project:update, project:delete
- document:upload, document:read, document:delete
- asset:create, asset:read, asset:update, asset:delete
- threat:create, threat:read, threat:update, threat:delete
- report:generate, report:read, report:download
- system:manage
```

### 9.2 数据安全

#### 9.2.1 敏感数据加密

- 密码使用bcrypt加密存储
- 敏感配置使用AES-256加密
- 数据库连接使用SSL/TLS

#### 9.2.2 文件安全

- 上传文件类型白名单校验
- 文件大小限制
- 存储路径随机化
- 访问权限控制

### 9.3 接口安全

- 所有接口使用HTTPS
- 请求频率限制
- SQL注入防护
- XSS防护
- CSRF防护

### 9.4 审计日志

```python
# 审计日志结构
{
    "id": "xxx",
    "user_id": 1,
    "username": "admin",
    "action": "project.create",
    "resource_type": "project",
    "resource_id": 123,
    "request_ip": "192.168.1.1",
    "request_ua": "Mozilla/5.0...",
    "request_params": {...},
    "response_code": 200,
    "created_at": "2025-01-16T10:00:00Z"
}
```

---

## 10. 部署方案

### 10.1 目录结构

```
intelli-tara/
├── frontend/                    # 前端项目
│   ├── src/
│   │   ├── components/         # 组件
│   │   ├── pages/              # 页面
│   │   ├── services/           # API服务
│   │   ├── stores/             # 状态管理
│   │   ├── styles/             # 样式
│   │   └── utils/              # 工具函数
│   ├── public/
│   ├── index.html
│   ├── package.json
│   ├── tailwind.config.js
│   ├── tsconfig.json
│   └── vite.config.ts
├── backend/                     # 后端项目
│   ├── app/
│   │   ├── api/                # API路由
│   │   │   └── v1/
│   │   ├── core/               # 核心配置
│   │   ├── models/             # 数据模型
│   │   ├── schemas/            # Pydantic模型
│   │   ├── services/           # 业务服务
│   │   ├── repositories/       # 数据访问
│   │   ├── clients/            # 外部客户端
│   │   └── utils/              # 工具函数
│   ├── alembic/                # 数据库迁移
│   ├── tests/                  # 测试
│   ├── pyproject.toml
│   └── main.py
├── deploy/                      # 部署配置
│   ├── docker/
│   │   ├── Dockerfile.frontend
│   │   ├── Dockerfile.backend
│   │   └── nginx.conf
│   ├── docker-compose.yml
│   ├── docker-compose.dev.yml
│   └── .env.example
├── docs/                        # 文档
├── specs/                       # 规格说明
├── scripts/                     # 脚本
├── Makefile                     # 构建脚本
└── README.md
```

### 10.2 Docker Compose配置

```yaml
version: '3.8'

services:
  # 前端服务
  frontend:
    build:
      context: ./frontend
      dockerfile: ../deploy/docker/Dockerfile.frontend
    ports:
      - "3000:80"
    depends_on:
      - backend

  # 后端服务
  backend:
    build:
      context: ./backend
      dockerfile: ../deploy/docker/Dockerfile.backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql+asyncmy://user:pass@mysql:3306/tara
      - REDIS_URL=redis://redis:6379/0
      - NEO4J_URI=bolt://neo4j:7687
      - MILVUS_HOST=milvus
      - ELASTICSEARCH_HOST=elasticsearch
      - MINIO_ENDPOINT=minio:9000
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - QWEN_API_KEY=${QWEN_API_KEY}
    depends_on:
      - mysql
      - redis
      - neo4j
      - milvus
      - elasticsearch
      - minio
      - kafka

  # MySQL
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=rootpass
      - MYSQL_DATABASE=tara
      - MYSQL_USER=tara
      - MYSQL_PASSWORD=tarapass
    volumes:
      - mysql_data:/var/lib/mysql

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # Neo4j
  neo4j:
    image: neo4j:5
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/neo4jpass
    volumes:
      - neo4j_data:/data

  # Milvus
  milvus:
    image: milvusdb/milvus:v2.3-latest
    ports:
      - "19530:19530"
    volumes:
      - milvus_data:/var/lib/milvus

  # Elasticsearch
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - es_data:/usr/share/elasticsearch/data

  # MinIO
  minio:
    image: minio/minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data

  # Kafka
  kafka:
    image: bitnami/kafka:latest
    ports:
      - "9092:9092"
    environment:
      - KAFKA_CFG_NODE_ID=0
      - KAFKA_CFG_PROCESS_ROLES=controller,broker
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
    volumes:
      - kafka_data:/bitnami/kafka

  # Nginx反向代理
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./deploy/docker/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - frontend
      - backend

volumes:
  mysql_data:
  redis_data:
  neo4j_data:
  milvus_data:
  es_data:
  minio_data:
  kafka_data:
```

### 10.3 Makefile

```makefile
.PHONY: help install dev build test deploy clean

help:
	@echo "Intelli-TARA 构建命令"
	@echo "  make install    - 安装依赖"
	@echo "  make dev        - 启动开发环境"
	@echo "  make build      - 构建生产版本"
	@echo "  make test       - 运行测试"
	@echo "  make deploy     - 部署服务"
	@echo "  make clean      - 清理构建文件"

install:
	cd frontend && npm install
	cd backend && uv sync

dev:
	docker-compose -f deploy/docker-compose.dev.yml up -d
	cd frontend && npm run dev &
	cd backend && uv run uvicorn main:app --reload

build:
	cd frontend && npm run build
	cd backend && uv build

test:
	cd frontend && npm run test
	cd backend && uv run pytest

deploy:
	docker-compose -f deploy/docker-compose.yml up -d --build

clean:
	cd frontend && rm -rf dist node_modules
	cd backend && rm -rf .venv __pycache__
	docker-compose down -v
```

### 10.4 环境要求

| 组件 | 最低配置 | 推荐配置 |
|-----|---------|---------|
| CPU | 4核 | 8核+ |
| 内存 | 16GB | 32GB+ |
| 存储 | 100GB SSD | 500GB SSD |
| 操作系统 | Ubuntu 22.04 LTS | Ubuntu 22.04 LTS |

### 10.5 服务端口规划

| 服务 | 端口 | 说明 |
|-----|------|------|
| Nginx | 80/443 | HTTP/HTTPS入口 |
| Frontend | 3000 | 前端开发服务 |
| Backend | 8000 | 后端API服务 |
| MySQL | 3306 | 关系数据库 |
| Redis | 6379 | 缓存服务 |
| Neo4j | 7474/7687 | 图数据库 |
| Milvus | 19530 | 向量数据库 |
| Elasticsearch | 9200 | 搜索引擎 |
| MinIO | 9000/9001 | 对象存储 |
| Kafka | 9092 | 消息队列 |

---

## 附录

### A. 术语表

| 术语 | 英文 | 说明 |
|-----|------|-----|
| TARA | Threat Analysis and Risk Assessment | 威胁分析与风险评估 |
| STRIDE | Spoofing, Tampering, Repudiation, Information Disclosure, DoS, EoP | 威胁建模方法 |
| WP29 | World Forum for Harmonization of Vehicle Regulations | 联合国车辆法规协调世界论坛 |
| ISO 21434 | ISO/SAE 21434:2021 | 道路车辆网络安全工程标准 |
| IVI | In-Vehicle Infotainment | 车载信息娱乐系统 |
| ECU | Electronic Control Unit | 电子控制单元 |
| CAN | Controller Area Network | 控制器局域网 |
| OTA | Over-The-Air | 空中下载技术 |

### B. 参考文献

1. ISO/SAE 21434:2021 Road vehicles — Cybersecurity engineering
2. UN Regulation No. 155 - Cyber security and cyber security management system
3. UN Regulation No. 156 - Software update and software update management system
4. NIST Cybersecurity Framework
5. OWASP Automotive Security Testing Guide

### C. 修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
|-----|------|-------|---------|
| 1.0 | 2026-01-16 | - | 初始版本 |
